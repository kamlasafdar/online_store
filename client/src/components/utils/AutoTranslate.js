// src/utils/AutoTranslate.js
class AutoTranslate {
  constructor() {
    this.currentLanguage = localStorage.getItem('selectedLanguage') || 'en';
    this.cache = new Map();
    this.isTranslating = false;
  }

  getSupportedLanguages() {
    return [
      { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
      { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
      { code: 'fr', name: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·' },
      { code: 'de', name: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª' },
      { code: 'it', name: 'Italiano', flag: 'ğŸ‡®ğŸ‡¹' },
      { code: 'pt', name: 'PortuguÃªs', flag: 'ğŸ‡µğŸ‡¹' },
      { code: 'ru', name: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', flag: 'ğŸ‡·ğŸ‡º' },
      { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
      { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
      { code: 'zh', name: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
      { code: 'ar', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', flag: 'ğŸ‡¸ğŸ‡¦' },
      { code: 'hi', name: 'à¤¹à¤¿à¤‚à¤¦à¥€', flag: 'ğŸ‡®ğŸ‡³' },
      { code: 'ur', name: 'Ø§Ø±Ø¯Ùˆ', flag: 'ğŸ‡µğŸ‡°' },
      { code: 'bn', name: 'à¦¬à¦¾à¦‚à¦²à¦¾', flag: 'ğŸ‡§ğŸ‡©' },
      { code: 'tr', name: 'TÃ¼rkÃ§e', flag: 'ğŸ‡¹ğŸ‡·' },
      { code: 'nl', name: 'Nederlands', flag: 'ğŸ‡³ğŸ‡±' },
      { code: 'sv', name: 'Svenska', flag: 'ğŸ‡¸ğŸ‡ª' },
      { code: 'pl', name: 'Polski', flag: 'ğŸ‡µğŸ‡±' },
      { code: 'th', name: 'à¹„à¸—à¸¢', flag: 'ğŸ‡¹ğŸ‡­' },
      { code: 'vi', name: 'Tiáº¿ng Viá»‡t', flag: 'ğŸ‡»ğŸ‡³' }
    ];
  }

  async translateText(text, targetLang) {
    if (!text || targetLang === 'en') return text;
    
    const cacheKey = `${text}_${targetLang}`;
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey);
    }

    try {
      const response = await fetch(
        `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${targetLang}`
      );
      const data = await response.json();
      
      const translatedText = data.responseData?.translatedText || text;
      this.cache.set(cacheKey, translatedText);
      return translatedText;
    } catch (error) {
      console.error('Translation error:', error);
      return text;
    }
  }

  isRTL(langCode) {
    const rtlLanguages = ['ar', 'ur', 'fa', 'he'];
    return rtlLanguages.includes(langCode);
  }

  async setLanguage(langCode) {
    this.currentLanguage = langCode;
    localStorage.setItem('selectedLanguage', langCode);
    
    document.documentElement.dir = this.isRTL(langCode) ? 'rtl' : 'ltr';
    document.documentElement.lang = langCode;
    
    window.dispatchEvent(new CustomEvent('languageChanged', { 
      detail: { language: langCode } 
    }));
  }

  getCurrentLanguage() {
    return this.currentLanguage;
  }
}

const autoTranslate = new AutoTranslate();
export default autoTranslate;